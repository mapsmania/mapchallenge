<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>World Map Projections</title>
<style>
  body { background:#111; color:#fff; font-family: sans-serif; margin:0; }
  header { padding:10px; text-align:center; }
  header span { margin:0 12px; cursor:pointer; color:#ccc; font-weight:bold; }
  header span.active { color:#4CAF50; }
  button {
    background: #222;
    color: #fff;
    border: 1px solid #4CAF50;
    border-radius: 6px;
    padding: 4px 10px;
    margin: 0 5px;
    cursor: pointer;
    font-size: 14px;
  }
  button:hover { background: #333; }
  svg { display:block; margin:auto; }
  .label {
    font-size:22px;
    font-weight:600;
    fill:#fff;
    text-anchor:middle;
  }
  #meta-panel {
    position: absolute;
    bottom: 15px;
    left: 15px;
    background: rgba(0,0,0,0.45);
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 14px;
    line-height: 1.4em;
    max-width: 280px;
  }
  #meta-panel b { color:#4CAF50; }
</style>
</head>
<body>

<header id="proj-header">
  <button id="pause-btn">Pause</button>
  <button id="play-btn">Play</button>
  <span data-proj="mercator" class="active">Mercator</span> -
  <span data-proj="mollweide">Mollweide</span> -
  <span data-proj="robinson">Robinson</span> -
  <span data-proj="equirectangular">Equirectangular</span> -
  <span data-proj="naturalEarth">Natural Earth</span> -
  <span data-proj="winkelTripel">Winkel Tripel</span> -
  <span data-proj="aitoff">Aitoff</span> -
  <span data-proj="hammer">Hammer</span> -
  <span data-proj="homolosine">Goode Homolosine</span>
</header>

<div id="meta-panel"></div>
<svg id="map" width="960" height="520"></svg>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>
<script src="https://unpkg.com/d3-geo-projection@4"></script>

<script>
(async function(){
  const width = 960, height = 520;
  const svg = d3.select("#map");
  const g = svg.append("g");
  const label = svg.append("text")
    .attr("class","label")
    .attr("x", width/2)
    .attr("y", height-20);

  const path = d3.geoPath();

  const projectionInfo = {
    mercator: { type:"Cylindrical conformal", preserves:"Shape (locally) & direction", distortion:"Severe area distortion near poles. Greenland appears huge." },
    mollweide: { type:"Pseudo-cylindrical equal-area", preserves:"Area", distortion:"Shape distortion increases outward from the center." },
    robinson: { type:"Pseudo-cylindrical compromise", preserves:"Nothing perfectly â€” a visual compromise", distortion:"Balances shape & area distortion for a pleasing world map." },
    equirectangular: { type:"Cylindrical, equidistant", preserves:"Equally spaced meridians & parallels", distortion:"Major distortion at high latitudes; shapes very inaccurate." },
    naturalEarth: { type:"Pseudo-cylindrical compromise", preserves:"Aesthetically pleasing global view", distortion:"Balanced compromise; low overall distortion." },
    winkelTripel: { type:"Pseudo-cylindrical compromise", preserves:"Compromise between area and shape", distortion:"Moderate distortion; used by National Geographic" },
    aitoff: { type:"Pseudo-cylindrical, equal-area variant", preserves:"Area approximately", distortion:"Shapes become stretched near edges" },
    hammer: { type:"Pseudo-cylindrical equal-area", preserves:"Area", distortion:"Shape distortion near edges, poles compressed" },
    homolosine: { type:"Interrupted pseudo-cylindrical equal-area", preserves:"Area", distortion:"Shape distortion in lobes; poles and oceans interrupted" },
  };

  const metaPanel = document.getElementById("meta-panel");

  function setMetadata(name){
    const info = projectionInfo[name];
    metaPanel.innerHTML = `
      <b>${name[0].toUpperCase() + name.slice(1)}</b><br>
      <b>Type:</b> ${info.type}<br>
      <b>Preserves:</b> ${info.preserves}<br>
      <b>Distortion:</b> ${info.distortion}
    `;
  }

  const projections = ["mercator","mollweide","robinson","equirectangular","naturalEarth","winkelTripel","aitoff","hammer","homolosine"];
  let currentIndex = 0;

  function makeProjection(name){
    const s = 150, c=[width/2,height/2];
    switch(name){
      case "mercator": return d3.geoMercator().scale(s).translate(c);
      case "mollweide": return d3.geoMollweide().scale(s).translate(c);
      case "robinson": return d3.geoRobinson().scale(s).translate(c);
      case "equirectangular": return d3.geoEquirectangular().scale(s).translate(c);
      case "naturalEarth": return d3.geoNaturalEarth1().scale(s).translate(c);
      case "winkelTripel": return d3.geoWinkel3().scale(s).translate(c);
      case "aitoff": return d3.geoAitoff().scale(s).translate(c);
      case "hammer": return d3.geoHammer().scale(s).translate(c);
      case "homolosine": return d3.geoInterruptedHomolosine().scale(s).translate(c);
      default: return d3.geoMercator().scale(s).translate(c);
    }
  }

  const topo = await d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json");
  const countries = topojson.feature(topo, topo.objects.countries).features;

  g.selectAll("path").data(countries).join("path")
    .attr("fill","#4CAF50")
    .attr("stroke","#111")
    .attr("stroke-width",0.4);

  function updateProjection(projName){
    const proj = makeProjection(projName);
    path.projection(proj);
    g.selectAll("path").transition().duration(1000).attr("d", path);
    label.text(projName[0].toUpperCase() + projName.slice(1));
    setMetadata(projName);
    d3.selectAll("#proj-header span").each(function(){
      this.classList.toggle("active", this.dataset.proj===projName);
    });
  }

  function nextProjection(){
    currentIndex = (currentIndex + 1) % projections.length;
    updateProjection(projections[currentIndex]);
  }

  // Header click handlers
  d3.selectAll("#proj-header span").on("click", function(){
    const projName = this.dataset.proj;
    currentIndex = projections.indexOf(projName);
    updateProjection(projName);
  });

  // --- Pause / Play Logic ---
  let interval = d3.interval(()=>nextProjection(), 2500);
  let isPaused = false;

  document.getElementById("pause-btn").addEventListener("click", ()=>{
    if (!isPaused){
      interval.stop();
      isPaused = true;
    }
  });

  document.getElementById("play-btn").addEventListener("click", ()=>{
    if (isPaused){
      interval = d3.interval(()=>nextProjection(), 2500);
      isPaused = false;
    }
  });

  // Initial projection
  updateProjection(projections[currentIndex]);

})();
</script>

</body>
</html>
