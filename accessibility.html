<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Roman Roads â€“ Reachable per Day</title>
  <script src="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
    .legend {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 6px;
      font-family: sans-serif;
      font-size: 13px;
      line-height: 1.5;
    }
    .legend div {
      display: flex;
      align-items: center;
    }
    .legend span {
      width: 20px;
      height: 10px;
      display: inline-block;
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="legend">
    <strong>Reachable in Days</strong><br/>
    <div><span style="background:#ff0000"></span> Day 1</div>
    <div><span style="background:#ff7f00"></span> Day 2</div>
    <div><span style="background:#ffff00"></span> Day 3</div>
    <div><span style="background:#7fff00"></span> Day 4</div>
    <div><span style="background:#00ff00"></span> Day 5</div>
  </div>

  <script>
    const map = new maplibregl.Map({
      container: 'map',
      style: 'https://tiles.openfreemap.org/styles/liberty', // or positron
      center: [-2.5, 54.0],
      zoom: 5
    });

    // Days in **reverse order** so shorter ranges overlay longer ones
    const days = [5,4,3,2,1];
    const colors = {
      1: '#ff0000',
      2: '#ff7f00',
      3: '#ffff00',
      4: '#7fff00',
      5: '#00ff00'
    };

    // Track loaded features to compute bounds
    let allFeatures = [];

    map.on('load', () => {
      days.forEach(day => {
        const url = `https://raw.githubusercontent.com/mapsmania/mapchallenge/main/data/reachable_roads_day_${day}.geojson`;
        
        map.addSource(`roads-day-${day}`, { type: 'geojson', data: url });

        map.addLayer({
          id: `roads-day-${day}`,
          type: 'line',
          source: `roads-day-${day}`,
          layout: { 'line-join': 'round', 'line-cap': 'round' },
          paint: {
            'line-color': colors[day],
            'line-width': 2.5,
            'line-opacity': 0.6
          }
        });

        // Fetch the data to extend map bounds
        fetch(url)
          .then(r => r.json())
          .then(data => {
            allFeatures = allFeatures.concat(data.features);
            if (allFeatures.length > 0) {
              const bounds = new maplibregl.LngLatBounds();
              allFeatures.forEach(f => {
                f.geometry.coordinates.flat(2).forEach(coord => bounds.extend(coord));
              });
              map.fitBounds(bounds, { padding: 40 });
            }
          });
      });
    });
  </script>
</body>
</html>
