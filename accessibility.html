const reachableOriginal = [];
const reachableSnapped = [];

graph.forEach((v, key) => {
  v.edges.forEach(e => {
    if (!distances[key] || !distances[e.to]) return;
    if (distances[key] + e.weight <= maxKm) {
      const feature = {
        type: 'Feature',
        geometry: { type: 'LineString', coordinates: [
          key.split(',').map(Number),
          e.to.split(',').map(Number)
        ]},
        properties: {}
      };
      if(e.snapped) reachableSnapped.push(feature);
      else reachableOriginal.push(feature);
    }
  });
});

map.addSource('reachable-original', { type:'geojson', data:{ type:'FeatureCollection', features: reachableOriginal }});
map.addSource('reachable-snapped', { type:'geojson', data:{ type:'FeatureCollection', features: reachableSnapped }});

// Layer for snapped edges
map.addLayer({
  id:'reachable-snapped',
  type:'line',
  source:'reachable-snapped',
  layout:{ 'line-join':'round','line-cap':'round' },
  paint:{ 'line-color':'#888888', 'line-width':2, 'line-dasharray':[2,2] } // gray dashed
});
